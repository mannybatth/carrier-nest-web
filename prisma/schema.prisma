datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
}

model Account {
    id                Int     @id @default(autoincrement())
    type              String
    provider          String
    providerAccountId String
    refreshToken      String? @map("refresh_token")
    accessToken       String? @map("access_token")
    expiresAt         Int?    @map("expires_at")
    tokenType         String? @map("token_type")
    scope             String?
    idToken           String?
    sessionState      String? @map("session_state")
    oauthTokenSecret  String? @map("oauth_token_secret")
    oauthToken        String? @map("oauth_token")

    user   User @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId Int

    @@unique([provider, providerAccountId])
}

model Session {
    id           Int      @id @default(autoincrement())
    sessionToken String   @unique
    userId       Int
    expires      DateTime
    user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
    id            Int            @id @default(autoincrement())
    createdAt     DateTime       @default(now())
    updatedAt     DateTime       @updatedAt
    name          String?
    email         String?        @unique
    emailVerified DateTime?
    image         String?
    accounts      Account[]
    sessions      Session[]
    loads         Load[]
    loadAddresses LoadAddress[]
    invoices      Invoice[]
    loadDocuments LoadDocument[]
}

model VerificationToken {
    id         Int      @id @default(autoincrement())
    identifier String
    token      String   @unique
    expires    DateTime

    @@unique([identifier, token])
}

model Load {
    id              Int            @id @default(autoincrement())
    user            User           @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId          Int
    customer        Customer       @relation(fields: [customerId], references: [id])
    customerId      Int
    driver          Driver?        @relation(fields: [driverId], references: [id])
    driverId        Int?
    createdAt       DateTime       @default(now())
    updatedAt       DateTime       @updatedAt
    refNum          String
    status          String
    statusUpdatedAt DateTime?
    pickUpDate      DateTime
    pickUpTime      String
    dropOffDate     DateTime
    dropOffTime     String
    fromAddresses   LoadAddress[]  @relation("fromAddress")
    toAddresses     LoadAddress[]  @relation("toAddress")
    rate            Decimal
    invoice         Invoice?
    distance        Int
    distanceUnit    String
    loadDocuments   LoadDocument[]
}

model LoadAddress {
    id         Int    @id @default(autoincrement())
    user       User   @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId     Int
    street     String
    city       String
    state      String
    zip        String
    country    String
    fromLoad   Load?  @relation("fromAddress", fields: [fromLoadId], references: [id])
    fromLoadId Int?
    toLoad     Load?  @relation("toAddress", fields: [toLoadId], references: [id])
    toLoadId   Int?
}

model Customer {
    id                 Int      @id @default(autoincrement())
    createdAt          DateTime @default(now())
    updatedAt          DateTime @updatedAt
    name               String
    contactEmail       String?
    billingEmail       String?
    paymentStatusEmail String?
    street             String?
    city               String?
    state              String?
    zip                String?
    country            String?
    loads              Load[]
}

model Driver {
    id        Int      @id @default(autoincrement())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    name      String
    email     String?
    phone     String?
    Load      Load[]
}

model Invoice {
    id          Int           @id @default(autoincrement())
    user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId      Int
    load        Load          @relation(fields: [loadId], references: [id], onDelete: Cascade)
    loadId      Int           @unique
    createdAt   DateTime      @default(now())
    updatedAt   DateTime      @updatedAt
    status      String
    totalAmount Decimal
    paidAmount  Decimal
    paidAt      DateTime?
    dueNetDays  Int           @default(0)
    extraItems  InvoiceItem[]
}

model InvoiceItem {
    id        Int     @id @default(autoincrement())
    invoice   Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
    invoiceId Int
    title     String
    amount    Decimal
}

model LoadDocument {
    id        Int      @id @default(autoincrement())
    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId    Int
    load      Load     @relation(fields: [loadId], references: [id], onDelete: Cascade)
    loadId    Int
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    title     String
    filename  String
}
